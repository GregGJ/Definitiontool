{"code":"import { DrongoEvent } from \"../events/DrongoEvent\";\r\nimport { Task } from \"./Task\";\r\n/**\r\n * 任务队列\r\n */\r\nexport class TaskQueue extends Task {\r\n    constructor() {\r\n        super();\r\n        this.__index = 0;\r\n        this.__taskList = [];\r\n    }\r\n    addTask(value) {\r\n        if (this.__taskList.indexOf(value) >= 0) {\r\n            throw new Error(\"重复添加！\");\r\n        }\r\n        this.__taskList.push(value);\r\n    }\r\n    removeTask(value) {\r\n        let index = this.__taskList.indexOf(value);\r\n        if (index < 0) {\r\n            throw new Error(\"未找到要删除的内容！\");\r\n        }\r\n        this.__taskList.splice(index, 1);\r\n    }\r\n    start(data) {\r\n        this.__index = 0;\r\n        this.__tryNext();\r\n    }\r\n    __tryNext() {\r\n        if (this.__index < this.__taskList.length) {\r\n            let task = this.__taskList[this.__index];\r\n            task.addEvent(DrongoEvent.COMPLETE, this, this.__subTaskEventHandler);\r\n            task.addEvent(DrongoEvent.PROGRESS, this, this.__subTaskEventHandler);\r\n            task.addEvent(DrongoEvent.ERROR, this, this.__subTaskEventHandler);\r\n            task.start();\r\n        }\r\n        else {\r\n            //结束\r\n            this.dispatchEvent(DrongoEvent.COMPLETE);\r\n        }\r\n    }\r\n    __subTaskEventHandler(key, target, data) {\r\n        if (key == DrongoEvent.PROGRESS) {\r\n            let progress = isNaN(data) ? (this.__index + data) / this.__taskList.length : this.__index / this.__taskList.length;\r\n            this.dispatchEvent(DrongoEvent.PROGRESS, progress);\r\n            return;\r\n        }\r\n        target.removeAllEvent();\r\n        if (key == DrongoEvent.ERROR) {\r\n            this.dispatchEvent(DrongoEvent.ERROR, data);\r\n            return;\r\n        }\r\n        target.destroy();\r\n        this.__index++;\r\n        this.__tryNext();\r\n    }\r\n    destroy() {\r\n        super.destroy();\r\n        this.__taskList.length = 0;\r\n        this.__index = 0;\r\n    }\r\n}\r\n","references":["D:/DefinitionTool/src/drongo/events/DrongoEvent.ts","D:/DefinitionTool/src/drongo/task/ITask.ts","D:/DefinitionTool/src/drongo/task/Task.ts"]}
